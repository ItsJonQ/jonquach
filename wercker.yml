# This references the default Ruby container from
# the Docker Hub.
# https://registry.hub.docker.com/_/ruby/
box: starefossen/ruby-node

# This is the build pipeline. Pipelines are the core of wercker
# Read more about pipelines on our dev center
# http://devcenter.wercker.com/docs/pipelines/index.html

build:
  # Steps make up the actions in your pipeline
  # Read more about steps on our dev center:
  # http://devcenter.wercker.com/docs/steps/index.html
  steps:
    - script:
        name: git config https
        code: git config --global url."https://".insteadOf git://
    - script:
        name: git token
        code: echo -e "machine github.com\n  login $CI_USER_TOKEN" >> ~/.netrc
    - script:
        name: git config user
        code: |-
          git config --global user.email "itsjonq@gmail.com"
          git config --global user.name "ItsJonQ"
    - bundle-install
    - script:
        name: npm install
        code: npm install
    - script:
        name: build
        code: gulp build

deploy:
  steps:
    - add-ssh-key:
        keyname: DO_DEPLOY_KEY
    - add-to-known_hosts:
        hostname: $DO_HOST
    - script:
      name: deploy to digital ocean
      code: rsync -a _site/ $DO_HOST:$DO_DEST
